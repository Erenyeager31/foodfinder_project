<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

    <!-- <link rel="stylesheet" type="text/css" href="./style.css" /> -->
    <!-- <script type="module" src="./index.js"></script> -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <script src="https://ajax.aspnetCDN.com/ajax/jQuery/jQuery-3.3.1.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
      integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
      crossorigin="anonymous"
    ></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCt47m0SqIKRIfHOReFJOY5okxGecIwMSc&libraries=geometry,places"></script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>

  </head>

  <style>
    body {
      background-image: url('https://catchthemes.com/demo/catch-foodmania-dark/files/2018/09/Slider1-1920x1080.jpg');
      /* background-color: black; */
      opacity: 0.8;
      background-repeat:no-repeat-x;
      background-size: cover;
    }

    .options{
      width: 100%;
      height: 10%;
      margin-top: 100px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* position: fixed;
      top: 0;
      left: 0; */
      /* background-color: aqua; */
      z-index: 1000;
      padding-left: 10%;
      padding-right: 10%;
    }

    #box_container{
      margin-top: 2%;
    }
    
    .options button{
      border-color: aliceblue;
    }
  </style>

  <body>
    <!-- navbar-dark bg-dark -->
    <nav class="navbar navbar-dark bg-dark fixed-top opacity-75">
      <div class="container-fluid">
        <a class="navbar-brand opacity-100" href="#">Food Finder</a>
        <ul class="nav justify-content-center">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="home">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="aboutus">About Us</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contactus">Contact Us</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="profile">Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="showmaps">Maps</a>
          </li>
        </ul>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasDarkNavbar"
          aria-controls="offcanvasDarkNavbar"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="offcanvas offcanvas-end text-bg-dark"
          tabindex="-1"
          id="offcanvasDarkNavbar"
          aria-labelledby="offcanvasDarkNavbarLabel"
        >
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">
              FoodFinder
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
            ></button>
          </div>
          <div class="offcanvas-body">
            <form class="d-flex mt-3" role="search">
              {% csrf_token %}
              <input
                class="form-control me-2"
                type="search"
                placeholder="Search"
                aria-label="Search"
              />
              <button class="btn btn-success" type="submit">Search</button>
            </form>
            <br />
            <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="home"
                  >Home</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="aboutus">About Us</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="contactus">Contact Us</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="profile">Profile</a>
              </li>
            </ul>
            <br />
            <a
              class="btn btn-light rounded-pill px-3"
              onclick="logout()"
              type="button"
              >Logout</a
            >
            <!-- <button type="button" class="btn btn-dark border border-primary ">Logout</button> -->
          </div>
        </div>
      </div>
    </nav>

    <!-- Main content -->
    <div class="options">
      <button type="button" class="btn btn-dark" onclick="list_food()">LIST BY FOOD</button>
      <button type="button" class="btn btn-dark" onclick="list_shop()">LIST BY SHOP</button>
      <button type="button" class="btn btn-dark" onclick="popular()">POPULAR FOOD</button>
      <button type="button" class="btn btn-dark" onclick="rec()">RECOMMENDED FOOD</button>
    </div>

    <div class="album py-5 bg-body-primary" id="box_container">
      <div class="container"> 
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3">
          {% for i in food_list %}
          <div class="col">
            <div class="card shadow-sm">
              <img
                style="width: 100%; height: 250px; object-fit: cover"
                src="{{ i.img_url }}"
                class="card-img-top"
                alt="vadapav"
              />
              <div class="card-body">
                <p class="card-text">{{ i.food_name }}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <div class="btn-group">
                    <button
                      type="button"
                      class="btn btn-warning"
                    >
                      Buy
                    </button>
                    <button
                      type="button"
                      class="btn btn-success"
                      onclick="addCart('{{i.id}}');"
                    >
                      Add to cart
                    </button>
                  </div>
                  <!-- <small class="text-body-secondary">9 minutes</small> -->
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

      </div>
    </div>
  </body>
<script>
  function logout() {
      sessionStorage.removeItem('username')
      $.ajax({
        type: 'POST',
        url: '/logout',
        data: {
          csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        },
        success(data) {
          alert(data)
          window.location.assign('home')
        },
        error(err) {
          console.log(err)
        }
      })
    }

  function list_food(){
    window.location.reload()
  }

  async function list_shop(){
    $.ajax({
      type:'GET',
      url :'/listShop',
      data:{},
      success(data){
        // console.log("hi")
        console.log(data)
        // console.log("hi")
        $('.container').empty();

        $.each(data['seller'], function(index, item) {
        // console.log(index)
        var cardBodyId = 'card-body-' + index;
        var newItem =   '<div class="card mt-3">'+
                          '<div id="'+ cardBodyId +'" class="card-body">'+
                            '<ul class="list-group">'+
                               '<li class="list-group-item">'+
                                  '<strong>Business Name:</strong>' + item.business_name+ '<br>'+
                                  '<strong>ZIP Code:</strong>'+ item.zip +'<br>'+
                                  '<strong>Shop Address:</strong>'+ item.shop_add +'<br>'+
                                '</li>'+
                            '</ul>'+
                          '</div>'+                                
                        '</div>'

      $('.container').append(newItem);

      var row = $('<div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3"></div>');
      
      $.each(data['foods'], function(index, item_) {
        // console.log(item_['username'])
        if(item_['username'] == item.username){
          console.log(item_)
          var newItem = '<div class="col"> ' +
                      '   <div class="card shadow-sm"> ' +
                      '       <img style="width: 100%; height: 250px; object-fit: cover" src="' + item_.img_url + '" class="card-img-top" alt="' + item.food_name + '"> ' +
                      '       <div class="card-body"> ' +
                      '           <p class="card-text">' + item_.food_name + '</p> ' +
                      '           <div class="d-flex justify-content-between align-items-center"> ' +
                      '               <div class="btn-group"> ' +
                      '                 <button type="button" class="btn btn-warning">Buy</button>' + 
                      '                 <button type="button" class="btn btn-success" onclick="addCart('+ item_.id +');" > Add to cart </button>'+
                      '               </div> ' +
                      '           </div> ' +
                      '       </div> ' +
                      '   </div> ' +
                      '</div>';
          row.append(newItem)
        }
        // $('.card').append(newItem);
    });
    // $('.card:last-child').find('.card-body').append(row)
    $('#' + cardBodyId).append(row);

    });
                  
      },
      error(e){
        console.log(e)
      }
    })
  }

  function popular(){

  }

  function rec(){

  }

  function addCart(id){
    // alert(id)
      if(sessionStorage.getItem('role') == 'Customer'){
        $.ajax({
          type:"GET",
          url:'/AddtoCart',
          data:{
            "username":sessionStorage.getItem('username'),
            "id":id
          },
          success(data){
            alert(data)
          },
          error(e){
            console.log(e)
          }
        })
      }
      else{
        alert("Please Login to add to the Cart")
      }
    }
</script>
</html>
